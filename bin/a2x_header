#!/usr/bin/env python3

import os
import sys

from utils.output import Output

def main():
    Output.title('header', sys.argv)

    if len(sys.argv) != 3:
        Output.error('Usage: {} SourceDir HeaderFile'
            .format(os.path.basename(sys.argv[0])))

    source_dir = os.path.abspath(sys.argv[1])
    header_file = os.path.abspath(sys.argv[2])

    Output.info('Writing header {}'.format(os.path.basename(header_file)))

    with open(header_file, 'w') as f:
        f.write('#pragma once\n\n')

        headers = [h for h in os.listdir(source_dir) if h[-4 :] == '.p.h']
        headers.sort(key = lambda h: h)

        for h in headers:
            f.write('#include "{}"\n'.format(os.path.join('..', 'src', h)))

    Output.info('Done')

if __name__ == '__main__':
    main()
