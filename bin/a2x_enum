#!/usr/bin/env python3

"""
    Copyright 2019 Alex Margarit <alex@alxm.org>
    This file is part of a2x, a C video game framework.

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>.
"""

import re

from utils.tool import Tool

if __name__ == '__main__':
    tool = Tool('File.h EnumValue')

    h_file = tool.get_arg('File.h')
    enum_value = tool.get_arg('EnumValue')

    contents = tool.readtext(h_file)
    enums = re.findall('enum\s*\{\s*(.*?)\s*\}\s*\w*\s*;', contents, re.DOTALL)

    re_assignment = re.compile('^(\w+)\s*=\s*(.*)\s*$')
    re_noexplicit = re.compile('^(\w+)$')

    for e in enums:
        value = 0
        values = re.split('\s*,\s*', e)

        for v in values:
            m = re_assignment.match(v)

            if m:
                value = int(m.group(2))
            else:
                m = re_noexplicit.match(v)

            if m:
                name = m.group(1)

                if name == enum_value:
                    print(value)
                    tool.exit()

            value += 1

    print(-1)
